# Examples

All of the examples in this section use the **Van der Waals gas law**, a
generalization of the ideal gas law that accurately describes many gases over
a great range of temperatures, pressures, and volumes.

All examples use the Standard International (SI, also called *mks*) system of
units. When we define a quantity, we denote its units in square brackets. For
example, the mass of an object could be written as $m$ [kg]. Quantities without
units are followed by [-].

### Ideal gas

Recall that the ideal gas law relates the pressure, temperature, and volume of
a gas through the equation of state

$$
pV = \nu R T
$$

where

* $p$ is the gas pressure [Pa]
* $V$ is the volume occupied by the gas [m$^3$]
* $\nu$ is the number of moles of gas contained in the volume $V$ [-]
* $R$ is the universal gas constant [J $\cdot$ K$^{-1} \cdot$ mol$^{-1}$]
* $T$ is the temperature of the gas [K]

Strictly speaking, the ideal gas law holds for gases whose molecules do not
interact with one another. While this is not true for any known substance, it's
a good approximation for gases whose molecules interact only weakly.

### Van der Waals gas

The equation of state for the van der Waals gas law is a refinement of the ideal
gas law that attempts to model weak interactions between particles using a pair
of parameters $a$ and $b$. The equation is

$$
(p + a/V^2)(V - b) = \nu RT
$$

where $a$ represents the effects of cohesive forces within a molecule, and $b$
represents effects of molecules having a finite size. Clearly, when $a=b=0$,
this equation reverts to the ideal gas law.

Our study of the Van der Waals gas law follows the discussion in Chapter IV of
*Thermodynamics*, by Enrico Fermi, Dover Publications, NY (1936). Here, we'll
use Skywalker to explore the effects of different values of $a$ and $b$.

## Example 1: Plotting Isotherms

An isotherm is a thermodynamic process in which the temperature remains the
same throughout its life cycle. Isothermal processes are important in any
setting in which smaller physical systems interact with a heat reservoir at a
given temperature.

### Ideal gas

We construct an isotherm for an ideal gas by writing the temperature $T$ as a
function of $p$ and $V$ for a single mole of gas ($\nu = 1$):

$$
T(p, V) = \frac{pV}{R}
$$

This expression is true for $T >= T_b$, where $T_b$ is the *boiling point* of
the gas. For $T < T_b$, we assume a saturated vapor state in equilibrium with
liquid, for which the temperature and pressure are related by the Clapeyron
equation:

$$
\frac{dp}{dT} = \frac{\lambda}{T(v_g - v_l)}
$$

where

* $\lambda$ is the *latent heat of vaporization* [J/kg]
* $v_g$ is the *specific volume* (volume per unit mass) of the gas [m$^3$/kg]
* $v_l$ is the specific volume of the liquid [m$^3$/kg]

A specific volume $v$ is related to the volume $V$ through the mass of the
gas or liquid by $V = m v$, and the number of moles $\nu = m/M$, where $M$ is
the *molecular weight* of the gas or liquid. If $\nu = 1$, then $m = M$ and we
have $V = M v$.

Assuming that $p$ (and the other quantities) depend only on $T$, and that
$\lambda$ is constant over the relevant temperature range, we can integrate $p$
to get a relationship for $T$ for $T < T_b$:

$$
p(T) = p_0 \exp(-\lambda M / RT)
$$

(Replace $\lambda M$ by $\lambda$? See p 67 of Fermi.)

We calculate $T$ for various values of $p$ and $V$ and make a contour plot.
For simplicity, we use values of the parameters in the Clapeyron equation that
correspond to water in its liquid and vapor forms:

* $\lambda = 2,260,000$
* $v_g = 1677$
* $v_l = 1.043$

Here's a simple Skywalker program that computes $T$ from $p$ and $V$ for each
member of an ensemble:

=== "C"

    ```
    // T_gas.c
    #include <skywalker.h>

    ```

=== "C++"

    ```
    // T_gas.cpp
    #include <skywalker.hpp>
    ```

=== "Fortran"

    ```
    ! T_gas.F90
    use skywalker
    ```

Here's a YAML input file that constructs an ensemble whose members have
pressures and volumes sampled from a regular lattice of specified values. We
call this a **lattice ensemble**.

```
# ideal_isotherms.yaml
```

We compile our Skywalker program into an executable called `T_gas` and
run it with the input, which generates an output file named
`ideal_isotherms.py`.

```
T_gas ideal_isotherms.yaml
```

The output file produced is a Python module containing the output data for the
ensemble we just ran. We plot isotherms with the following Python script:

```
# plot_isotherms.py
```

Here's the plot generated by running `python3 plot_isotherms.py`:

### Nitrogen (N$_2$) gas

Diatomic nitrogen can be modeled with a Van Der Waals equation of state by
setting $a = 0.137$ and $b = 3.87 \times 10^{-5}$. Solving for $T$ in terms
of everything else, we have

$$
T(p, V) = \frac{(p + a/V^2)(V - b)}{R}
$$

We can modify our original program by adding `a` and `b` input parameters and
incorporating them into the calculation of the temperature:

=== "C"

    ```
    // T_gas.c
    #include <skywalker.h>

    ```

=== "C++"

    ```
    // T_gas.cpp
    #include <skywalker.hpp>
    ```

=== "Fortran"

    ```
    // T_gas.F90
    use skywalker
    ```

Similarly, we can create an input file (that fixes the values of `a` and `b`,
with everything else kept the same:

```
# n2_isotherms.yaml
```

We can run our program on this input file, and use the same Python script to
generate isotherm plots:

```
T_gas n2_isotherms.yaml
python3 n2_isotherms.py
```

Here's the resulting plot:

## Example 2: Supersaturation as a Function of $a$ and $b$

## Example 3: A Parameter Study Using Latin Hypercube Sampling
